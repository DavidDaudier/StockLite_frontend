<!-- Container gris avec recherche, filtre et produits -->
<div class="bg-gray-100 rounded-[15px] p-4 border border-gray-300 shadow-md overflow-hidden hover:shadow-lg transition-shadow">
  <!-- Barre de recherche et filtre -->
  <div class="flex gap-4 mb-4">
    <!-- Barre de recherche -->
    <div class="flex-1">
      <div class="relative">
        <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
          <ng-icon name="hugeSearch01" class="text-gray-400 text-lg" />
        </div>
        <input
          type="text"
          [ngModel]="searchTerm()"
          (ngModelChange)="searchTerm.set($event)"
          placeholder="Search in products"
          class="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm bg-white"
        />
      </div>
    </div>

    <!-- Select de catégorie -->
    <div class="w-56">
      <select
        [ngModel]="selectedCategoryId()"
        (ngModelChange)="onCategoryChange($event)"
        class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm bg-white">
        <option [ngValue]="null">All Category</option>
        <option *ngFor="let cat of categories()" [ngValue]="cat.id">{{ cat.name }}</option>
      </select>
    </div>
  </div>

  <!-- Grille de produits avec auto-fill pour garder la taille des cartes constante -->
  <div class="grid gap-3" style="grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));">
  <ng-container *ngFor="let p of filteredProducts()">
    <div
      *ngIf="p.stock > 0"
      (click)="select(p)"
      [ngClass]="cardClasses(p.id) + ' border rounded-xl shadow cursor-pointer transition flex flex-col'">

      <!-- <img [src]="p.img" class="h-32 w-full object-cover rounded-t-xl" /> -->
      <div class="p-3 flex flex-col flex-1">
        <!-- Nom et infos (hauteur fixe) -->
        <div class="mb-3">
          <p class="font-semibold line-clamp-2 min-h-[2.5rem]">{{ p.name }}</p>
          <p class="text-sm text-slate-600">${{ p.price.toFixed(2) }}</p>
          <p class="text-sm text-slate-600">Stocks: {{ p.stock }}</p>
        </div>

        <!-- + / – (fixe en bas) -->
        <div class="flex items-center justify-between mt-auto">
          <button
            (click)="$event.stopPropagation(); changeQty(p.id, -1)"
            [disabled]="(cartProduct.items() | quantity:p.id) <= 0"
            class="bg-red-200 rounded-full w-10 h-10 flex items-center justify-center cursor-pointer inset-shadow-sm inset-shadow-gray-400 hover:inset-shadow-none disabled:opacity-50">
            <ng-icon name="hugeMinusSign" class="text-sm" />
          </button>

          <span class="text-sm font-bold w-5 text-center">
            {{ cartProduct.items() | quantity:p.id }}
          </span>

          <button
            (click)="$event.stopPropagation(); changeQty(p.id, 1)"
            [disabled]="p.stock === 0"
            class="bg-blue-200 rounded-full w-10 h-10 flex items-center justify-center cursor-pointer inset-shadow-sm inset-shadow-gray-400 disabled:opacity-50">
            <ng-icon name="hugePlusSign" class="text-sm" />
          </button>
        </div>
      </div>
    </div>
  </ng-container>
  </div>

  <!-- Message si aucun produit trouvé -->
  <div *ngIf="filteredProducts().length === 0" class="text-center py-12">
    <p class="text-gray-500 text-lg">Aucun produit trouvé</p>
  </div>
</div>